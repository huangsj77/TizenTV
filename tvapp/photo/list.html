<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PHOTO LIST</title>
    <meta name="viewport" content="width=1920" />
    <link rel="stylesheet" href="../photo/css/info.css"/>
    <style>
        .photo-info{
            height: auto;
        }
        .photo-info div{
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div class="main">
    <div id="photomain" class="photo-main">
        <div id="main_bar" class="main-bar"></div>
        <div class="main-listcont">
            <img id="arrow-left" src="../image/ar_hotel_l.png"  style="display: none;position: absolute;" />
            <div style="position: relative;left:80px;"><span id="main_list" class="main-list"></span></div>
            <img id="arrow-right" src="../image/ar_hotel_r.png" style="display: none;"  />
        </div>
        <div class="photo-info" style="background: url(./image/bg_hotel_btn.png);background-size: 100% 100%">
            <span id="photo_title"></span>
            <img src="../image/vline.jpg" />
            <div  id="photo_intro">
            </div>
        </div>
        <img src="../image/op_intro.png" class="op-intro"/>
    </div>
</div>
</body>
</html>
<script type="text/javascript" src="../video/public/js/config.js"></script>
<script type="text/javascript" src="../video/public/js/jsget.js"></script>
<script type="text/javascript" src="../js/querystring.js"></script>
<script type="text/javascript" src="../../js/cate.js"></script>
<script type="text/javascript" src="../public/js/hlist.js"></script>

<script type="text/javascript">

    var cid = null;
    var photoItem = new PhotoItem();
    photoItem.onload = function( photoInfo ) {
        document.getElementById("photo_title").innerHTML = photoInfo.name;
        document.getElementById("photo_intro").innerHTML = photoInfo.about;
    }
    photoItem.tryload = function( mid ) {
        document.getElementById("photo_title").innerHTML = "";
        document.getElementById("photo_intro").innerHTML = "";
        if ( !! mid )    this.load( mid );
    }

    var itemList = new ItemList();
    itemList.onload = function( ilist ) {
        if ( cateList.slideshow_mode  == true && ilist.length  == 1 ) {
            itemList.slideShow( ilist[0].id );
            return;
        }

        var photo_current_status =  JSON.parse( sessionStorage.getItem("photo_current_status") );


        var found_idx = 0;

        if( ilist.length >=5 ) {
            document.getElementById("arrow-left").style.display = "block";
            document.getElementById("arrow-right").style.display = "block";
        }
        var str = "";
        for( i=0; i<ilist.length; i++ ) {
            var s = "<a href='javascript:;' onclick='itemList.onItemClick("+ilist[i].id+")' "
                + "onfocus='photoItem.tryload("+ilist[i].id+")' "
                + "style='background-image:url("+ilist[i].logo+")' "
                + "><div>"
                +ilist[i].name+"</div></a>";
            str += s;
            if ( !!photo_current_status && photo_current_status.mid == ilist[i].id ) {
                found_idx = i;
            }
        }

        var mainlist = document.getElementById("main_list");
        mainlist.innerHTML = str;
        var hlister = new HLister( mainlist , 5 );
        if ( !!ilist.length )
            photoItem.tryload( ilist[0].id );
        else
            photoItem.tryload( );

        if ( !!photo_current_status ) {
            while ( found_idx >= hlister.pageSize && hlister.startIndex + hlister.pageSize <= found_idx ) {
                hlister.next();
            }
            var ele = mainlist.getElementsByTagName("a")[found_idx];
            console.log("found ele: " + ele.outerHTML );
            console.log("found ele: " + ele.offsetWidth + " : " + ele.outerHTML );
            VatataKeyMove.initById( ele );
            sessionStorage.removeItem("photo_current_status");
        }
    }

    itemList.slideShow = function( id ) {
        var viewurl = "slideshow.html?photo_id=" + id;
        location.replace(  viewurl );
    }

    itemList.onItemClick = function( id ) {
        var viewurl = "view.html?photo_id=" + id;
        // var wobj = wae.create("WAE.Window");
        // wobj.open( viewurl );

        var current_photo_status = {};
        current_photo_status.cid = itemList.cid;
        current_photo_status.mid = id;
        //alert( JSON.stringify(current_photo_status) );

        sessionStorage.setItem("photo_current_status", JSON.stringify(current_photo_status));
        location.href = viewurl;
    }

    var cateList = new CateList();
    cateList.slideshow_mode = false;

    cateList.onload = function(clist, cfrom ) {
        if( cfrom.icon3.indexOf("uploadfiles") >= 0) {
            var contele = document.getElementById("photomain");
            // contele.style.backgroundImage = "url(" + cfrom.icon3.replace("index.php/","") + ")";
            window.localStorage.setItem("bg_"+cid, cfrom.icon3.replace("index.php/",""));
        } else {
            window.localStorage.removeItem("bg_"+cid);
        }

        var str = "";
        if ( clist.length == 0 ) {
            // alert( "slide show " + this.cid );
            cateList.slideshow_mode = true;
            itemList.load( this.cid,1,50);
            return;
        }

        var photo_current_status =  JSON.parse( sessionStorage.getItem("photo_current_status") );

        var found_idx = 0;
        for(var i =0; i<clist.length;i++ ) {
            var s = "<a href='javascript:;' onfocus='itemList.load("+clist[i].cat_id+",1,50);'>"+clist[i].cat_name+"</a>";
            if( !!photo_current_status && photo_current_status.cid == clist[i].cat_id ) {
                found_idx = i;
            }
            str += s;
        }

        var maincate = document.getElementById("main_bar");
        maincate.innerHTML = str;
        var hlister = new HLister( maincate , 3 );
        // itemList.load( clist[found_idx].cat_id , 1, 50 );
        while ( found_idx >= hlister.pageSize && hlister.startIndex + hlister.pageSize <= found_idx ) {
            hlister.next();
        }

        VatataKeyMove.initById( maincate.getElementsByTagName("a")[found_idx] );
    }



    function setBackground() {
        var bgpath = window.localStorage.getItem("bg_"+cid);
        var contele = document.getElementById("photomain");

        if ( !bgpath ) {
            contele.style.backgroundImage = "url(image/bg_hotel.jpg)";
        } else {
            contele.style.backgroundImage = "url("+ bgpath+")";
        }
    }

    //window.onWAEReady = function(waeObj){

        //var settingObj = wae.create("WAE.Setting");
        //settingObj.setUseLocalImageCache(true);

        //var uiSettings = wae.create("UI.UISettings");
       // uiSettings.set1080P();

        //var param = wae.create("DATA.Parameters");
        //var title = param.get("name");
        //var apiUrl = param.get("apiUrl");

        //if(!apiUrl) apiUrl =  param.get("DATA");
        var res = apiUrl.match(new RegExp("cat_id=(\\d+)","i"));
        cid = apiUrl;
        if ( res )
            cid = res[1];

        cateList.load( cid );

        setBackground();
    //}


</script>
<script type="text/javascript" src="player/js/key.js"></script>
