<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FOOD</title>
    <meta name="viewport" content="width=1920" />
    <link rel="stylesheet" href="../message/public.css"/>
    <link rel="stylesheet" href="../shop/css/shop.css"/>
</head>
<body>
<div class="tvmain">
  <div class="tvcontent" style="background-image: url(image/bg_food.jpg)">
  	<div class="foodtitlecont">
  		<img src="../../icon.png"/>
  		<div id="foodtime"></div>
  	</div>
  	<div class="foodlistcont">
  		<div id="foodtitle"></div>
	  	<div id="foodlist" class="foodlist"></div>
	  	<div class="paycont" style="display:none;"><a href="../shop/pay.html" id="checkout2">結賬</a></div>
  	</div>
  	<div id="foodpageidx" class="foodpageidx"></div>
  </div>
  <div class="remoterhint">  </div>
  <div class="remoterhotkeyhint">
  	<img src="../image/btn_blue.png" />
	  <a href="../shop/pay.html" id="checkout2">結賬</a>
  </div>
</div>
</body>
</html>
<script type="text/javascript" src="../video/public/js/lang.js"></script>
<script type="text/javascript">
document.getElementById("checkout1").innerHTML = TR("CheckOut");
document.getElementById("checkout2").innerHTML = TR("CheckOut");


</script>
<script type="text/javascript" src="../video/public/js/config.js"></script>
<script type="text/javascript" src="../video/public/js/jsget.js"></script>
<script type="text/javascript" src="../../js/cate.js"></script>
<script type="text/javascript" src="../js/querystring.js"></script>
<script type="text/javascript" src="../video/public/js/sharedata.js"></script>
<script type="text/javascript" src="player/js/key.js"></script>
<script type="text/javascript">
	if ( ! Request.q("cid") ) {
		location.href="sel.html";
	}
	function $(e) {
		return document.getElementById(e);
	}
	$("foodtitle").innerHTML = decodeURI(Request.q("n"));
	if( !! Request.q("t") )
		$("foodtime").innerHTML =  decodeURI(Request.q("t")).replace("-","<br/>~<br/>");

	var itemList = new ItemList();
	itemList.onload= function( listInfo, count, page ) {
		var str ="";
		for( var i =0; i<listInfo.length; i++ ) {
			var ordered_display = "display:none;";
			var cartItem = new CartItem( listInfo[i].id ) ;
			if ( cartItem.hasAdd() ) {
				ordered_display = "";
			}
			var ordered = "<span class='food-ordered' id='order_"+listInfo[i].id+"' "
						+ " style='"+ordered_display+"background-image:url(../image/bg_ordered.png)' >購物已加入</span>";

			var s = "<a href='javascript:;' onclick=\"location.href='item.html?iid="+listInfo[i].id+"';\" "
				  + "   style='background-image:url("+listInfo[i].logo+")' >"
				  + "   <div>"+listInfo[i].name+"</div>"
				  + "   <span id='price_"+listInfo[i].id+"'></span>"
				  + ordered
				  + "</a>";
			str += s;
		}
		$("foodlist").innerHTML = str;
		str = "";
		for( var j=1; j<= page; j++ ) {
			var s = "<span class='foodpageidx-point'></span>";
			if ( j == this.pageNo )
				s = "<span class='foodpageidx-point-c'></span>";
			str+=s;
		}
		$("foodpageidx").innerHTML = str;
		setTimeout( function() {
			VatataKeyMove.initById($("foodlist").getElementsByTagName("a")[0]);
		} , 100 );
	}

	itemList.load( Request.q("cid") , Request.q("p"), 6 );


	function getTotalPrice() {
	    var list = CartItem.getList();
	    totalPrice = 0;
	    for( var i = 0 ; i<list.length; i++ )  {
	      var citem = new CartItem( list[i] );
	      totalPrice += parseInt(citem.getNum()) * parseInt(citem.getPrice());
	    }
	    return totalPrice;
	}

	VatataKeyMove.fallUp = function() {
		itemList.prev();
	}
	VatataKeyMove.fallDn = function() {
		itemList.next();
	}

  const SYS_KEY_BACK = 4;
  const SYS_KEY_BLUE = 115;

  function hotKey() {
  }

  hotKey.init = function() {
    this.eventListener = wae.create("EventListener");
    this.eventListener.addJs( SYS_KEY_BLUE,   "hotKey.blue();" );
    this.eventListener.addJs( SYS_KEY_BACK ,  "hotKey.back();");
  }
  hotKey.blue = function() {
  	location.href = "pay.html";
  }
  hotKey.back = function() {
  	this.eventListener.clear();
  	if ( getTotalPrice() > 0 ) {
  		location.href = "pay.html";
  	} else {
	  	history.go(-1);
  	}
  }

  window.onWAEReady = function() {
  	hotKey.init();
  }

</script>
