<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SERVICES</title>
    <meta name="viewport" content="width=1920" />
    <link rel="stylesheet" href="../message/public.css"/>
    <link rel="stylesheet" href="../services/services.css"/>
</head>
<body>
<div class="main">
	<div class="maincont xfzdcont">
		<div class="zdtitle">  
			<span class="zdroomnum" id="iroom">房號</span>  
			<span class="zdguestname" id="itotal">總計</span>
		</div>
		<div class="zdheader">
			<span class="zddate" id="idate">日期</span>
			<span class="zdtime" id="iname">名称</span>
			<span class="zditem" id="iitem">数量</span>
			<span class="zdprice" id="isum">總計</span>
			<span class="zddetail" id="iothers">備註</span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
		<div class="zdline">
			<span class="zddate"></span>
			<span class="zdtime"></span>
			<span class="zditem"></span>
			<span class="zdprice"></span>
			<span class="zddetail"></span>
		</div>
	</div>

	<div style='display: none;' class="hotkeytips" onclick="getRedKey()"><img src="../image/btn_red.png"/><span id="fastcheckout">快速退房</span></div>
	<div style='display: none;' class="hotkeymsg"><span id="fastcheckoutbtn">快速退房，請按 </span><img onclick="getRedKey()" src="../image/btn_red.png"/></div>
	<a href="#"></a>
	<div class="maintitle" id="ititle">My Bill</div>
	<img src="../image/op_intro.png" class="remoter-tips"/>

</div>

</body>
</html>
<script type="text/javascript" src="../video/public/js/lang.js"></script>
<script type="text/javascript">
function $(name) {
	return document.getElementById(name);
}

$("ititle").innerHTML = TR("Bill");
$("iroom").innerHTML = TR("Room");
$("itotal").innerHTML = TR("Sum");
$("iname").innerHTML = TR("Name");
$("idate").innerHTML = TR("Date");
// $("itime").innerHTML = TR("Time");
$("iitem").innerHTML = TR("Num");
$("isum").innerHTML = TR("Sum");
$("iothers").innerHTML = TR("Others");
$("fastcheckout").innerHTML = TR("Fast Checkout");
$("fastcheckoutbtn").innerHTML = TR("Fast Checkout, Press");
</script>
<script type="text/javascript" src="player/js/key.js"></script>
<script type="text/javascript" src="../video/public/js/config.js"></script>
<script type="text/javascript" src="../video/public/js/jsget.js"></script>
<script type="text/javascript" src="../../js/cate.js"></script>
<script type="text/javascript" src="../video/public/js/deviceinfo.js"></script>
<script type="text/javascript">

var dtimer = setTimeout( function() {
	alert( TR("Invalid Device, No Room Number for the Device!") );
}, 1000 * 10 );

var cRoomNo = "";

var deviceInfo = new DeviceInfo();
deviceInfo.onload = function( dinfo ) {
	if ( dtimer != null ) clearTimeout( dtimer );

	var roomno = deviceInfo.info.customer2;
	cRoomNo = roomno;

	update( roomno );
}

deviceInfo.load();

</script>

<script type="text/javascript">

var totalBalance = -1;
var cOrderNo = "";
	
	function getRedKey() {
		var msg = new PushMessage();
		msg.push( 925, "快速退房", deviceInfo.info.contacts, "快速退房" , "");		

		if ( totalBalance == -1 ) {
			alert( TR("Error, No balance, please retry later!") );
			return;
		}

		if ( ! cOrderNo ) {
			alert( TR("Error, No order info!") );
			return;
		}

		if ( ! cRoomNo ) {
			alert( TR("Error, No room no!") );
			return;
		}

		var burl = SERVER_URL + "index.php/opera/api/RemoteCheckout?roomNo=" + cRoomNo  + "&resNo=" + cOrderNo + "&balance=" + totalBalance  ;

		var uget = new EasyGet();
		uget.onsuccess = function( u , d ) {
			var r = JSON.parse(d);
			if ( parseInt(r.code) == 200 ) {
				alert( TR("Checkout Success") );
			} else {
				alert( TR("Error, Checkout failed") + ":" + r.msg );
			}
		}
		uget.open( burl, true );

	}

	document.onkeydown = function( e ) {
		//alert( e.keyCode );
		if ( e.keyCode == KEY_RED ) {
			getRedKey();
		}
	}

	/*
	window.onWAEReady = function() {
		var eventListener = wae.create("EventListener");
		eventListener.addCurJs( KEY_RED , "getRedKey()");

		var uiSettings = wae.create("UI.UISettings");
		uiSettings.set1080P();
	}
	*/


function formatdate( str ) {
	var y = str.substr(0,4);
	var m = str.substr(4,2);
	var d = str.substr(6,2);
	if ( !! d )
		return y + "-" + m + "-" + d;
	return "";
}
function formattime( str ) {
	var h = str.substr(0,2);
	var m = str.substr(2,2);
	var s = str.substr(4,2);
	if ( !! s )
		return h + ":" + m + ":" + s;
	return "";
}
function formatmoney( str ) {
	var d = parseInt(str);
	var c = d % 100;
	var y = d / 100;

	if ( c < 10 )
		return y + ".0" + c;
	else
		return y + "." + c;
}

function update( roomno ) {
	//var burl = SERVER_URL + "index.php/opera/api/BillingRequest?roomNo=" + roomno  + "&resNo=" + orderno ;
    var burl = SERVER_URL + "index.php/photo/api?action=bill&id=17&roomNo="+roomno+"&device_id=m001A1D131E85&type=detail";

	// return;
	var httpobj = wae.create("Net.HttpClient");
	var d = httpobj.getWithSync(burl );

	var binfo = JSON.parse( d );
	if ( ! binfo ) {
		alert( TR("No Order Info") );
		return;
	}

	var billinfo = binfo["bill_list"];
	var billline = document.body.getElementsByClassName("zdline");

	var _tPrice = 0;
	for( var i = 0; i< billline.length && i < billinfo.length; i++ ) {
	    if( billinfo[i].about ) {
            var _list = billinfo[i].about.split(",,");
            var _info = _list[0].split(",");
            var _total = _list[2];
            var _time = new Date( billinfo[i].created * 1000);
            var date = _time.getFullYear() + "-"+ (_time.getMonth()+1) + "-"+_time.getDay();
            var s = "";
            s += '<span class="zddate">'+ date +'</span>';
            s += '<span class="zdtime">' + _info[1]+ '</span>';
            s += '<span class="zditem">'+_info[2]+'</span>';
            s += '<span class="zdprice">'+ _total +'</span>';
            s += '<span class="zddetail">'+ "" + '</span>';
		} else {
			var date = "";
			var _infoName = billinfo[i].name;
			var _total = billinfo[i].total;
            var s = "";
            s += '<span class="zddate"></span>';
            s += '<span class="zdtime">' + _infoName + '</span>';
            s += '<span class="zditem"></span>';
            s += '<span class="zdprice">'+ _total +'</span>';
            s += '<span class="zddetail">'+ "" + '</span>';

		}


        _tPrice += parseFloat(_total);
		billline[i].innerHTML = s;
		document.getElementById("iroom").innerHTML = TR("Room") + ": " + roomno ;
	}
	document.getElementById("itotal").innerHTML = TR("Sum") + ": " + _tPrice + "  LKR";
	// totalBalance = binfo.BillBalance;
}

</script>
