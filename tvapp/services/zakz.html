<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SERVICES</title>
    <meta name="viewport" content="width=1920" />
    <link rel="stylesheet" href="../message/public.css"/>
    <link rel="stylesheet" href="../services/services.css"/>
</head>
<body>
<div class="main">
	<div class="maincont clockcont">
		<div class="clockinput">
			<a href="javascript:showSetOK();" id="hourinput">08</a>
			<a href="javascript:showSetOK();" id="mininput">00</a>
		</div>
		<script>
			var clockTimer = null;
			function checkClock() {
				var now =new Date(); 
				var nowh = now.getHours(); 
				var nowm = now.getMinutes(); 

				// var clockh = parseInt( hourinput.textContent );
				// var clockm = parseInt( mininput.textContent  );

				var clockh = parseInt( localStorage.getItem("AlarmHour"));
				var clockm = parseInt( localStorage.getItem("AlarmMinute") );

				if( clockh == 0 && clockm == 0 )
					return;

				console.log("alarm , set to time: " + clockh + ":" + clockm  + " , now is " + nowh + ":" + nowm );

				if ( nowh == clockh && nowm == clockm ) {
					showAlert();
				}
			}
			function $( eid ) {
				return document.getElementById(eid);
			}

			function showSetOK() {
				console.log("showSetOK")
				$("clockalert").style.display = "none";
				$("clocksetok").style.display = "block";
				VatataKeyMove.initById( "clocksetokbtn" );

				var clockh = parseInt( $("hourinput").innerHTML );
				var clockm = parseInt( $("mininput").innerHTML  );

				// var clockh = parseInt( hourinput.textContent );
				// var clockm = parseInt( mininput.textContent  );

				localStorage.setItem( "AlarmHour", clockh);
				localStorage.setItem( "AlarmMinute", clockm);

				if ( clockTimer != null ) clearInterval( clockTimer );
				clockTimer = setInterval( checkClock, 1000 * 10 );

				var alarm = wae.create("Utils.Alarm");
				alarm.putExtra("url", location.href );
				// alarm.start();
				alarm.startAtToday( clockh, clockm, 0 );
				//alarm.startAtTomorrow( clockh, clockm, 0 );
			}
			function hideSetOK() {
				console.log("hideSetOK");
				$("clockalert").style.display = "none";
				$("clocksetok").style.display = "none";
				VatataKeyMove.initById( "hourinput" );
			}

			var alertTimer = null;
			var alarmPlayer = null;
			function showAlert() {
				if ( clockTimer != null ) clearInterval( clockTimer );
				clockTimer = null;
				$("clockalert").style.display = "block";
				$("clocksetok").style.display = "none";
				VatataKeyMove.initById( "clockalertbtn" );
				if ( alertTimer != null ) clearTimeout( alertTimer );

				alarmPlayer = wae.create("Media.MusicPlayer");
				var mp3url = location.href.replace("file://","").replace("zakz.html", "alarm.mp3");
				alarmPlayer.play( mp3url );
				alertTimer = setTimeout( hideAlert , 1000 * 60 * 1 );
			}

			function hideAlert() {
				if ( alertTimer != null ) clearTimeout( alertTimer );
				alertTimer = null;
				$("clockalert").style.display = "none";
				$("clocksetok").style.display = "none";
				VatataKeyMove.initById( "hourinput" );	
				if( alarmPlayer != null )
					alarmPlayer.stop();			
			}

		</script>

		<div id="clocksetok" style="display:none;" class="clockalert">
			<h2 id="setup">設定完成</h2>
			<span id="setupinfo">
				鬧鐘響鈴時，
				<br />
				按遙控器任意鍵關閉響鈴。
			</span>
			<a id="clocksetokbtn" href="javascript:hideSetOK();">&nbsp;</a>
		</div>

		<div id="clockalert" style="display:none;" class="clockalert">
			<h2 id="alarm">鬧鐘時間</h2>
			<span id="alarmmsg">
				到達鬧鐘時間，
				<br />
				按遙控器任意鍵關閉響鈴。
			</span>
			<a id="clockalertbtn" href="javascript:hideAlert();">&nbsp;</a>
		</div>



	</div>

	<div class="maintitle" id="maintitle">鬧鐘設置</div>
	<img src="../image/op_intro.png" class="remoter-tips"/>  


	<div class="timedatebar">
	  		<div id="timeDiv" class="timebar"></div>
	  		<div id="dateDiv" class="datebar"></div>
	</div>
	<script type="text/javascript" src="../../js/timedate.js"></script>
	<script type="text/javascript">
		var timedate_obj = new Timedate();
		timedate_obj.setEle('timeDiv','dateDiv');
	</script>
</div>

</body>
</html>
<script type="text/javascript" src="../video/public/js/lang.js"></script>
<script type="text/javascript">
function $(name) {
	return document.getElementById(name);
}	
$("setup").innerHTML = TR("Setup");
$("setupinfo").innerHTML = TR("SetupInfo").replace("\n", "<br />");
$("alarm").innerHTML = TR("Alarm");
$("alarmmsg").innerHTML = TR("AlarmMsg");
$("maintitle").innerHTML = TR("Clock");


var clockh = parseInt( localStorage.getItem("AlarmHour"));
var clockm = parseInt( localStorage.getItem("AlarmMinute") );
if( isNaN(clockh) ) clockh = 8;
if( isNaN(clockm) ) clockm = 0;

clockh = ( clockh < 10 ) ? "0" + clockh : "" + clockh ;
clockm = ( clockm < 10 ) ? "0" + clockm : "" + clockm ;

$("hourinput").innerHTML = clockh;
$("mininput").innerHTML = clockm;

setTimeout(checkClock, 1000 );

if ( clockTimer != null ) clearInterval( clockTimer );
clockTimer = setInterval( checkClock, 1000 * 10 );

//var clockh = parseInt( hourinput.textContent );
//var clockm = parseInt( mininput.textContent  );

</script>
<script type="text/javascript" src="player/js/key.js"></script>
<script type="text/javascript">
	VatataKeyMove.fallDn = function ( cEle ) {
		var value = parseInt( cEle.textContent );
		if ( cEle.id == "hourinput" ) {
			var nv = ( value + 1 ) % 24;
			var sv = ( nv < 10 ) ? "0" + nv : "" + nv ;
			cEle.textContent = sv;
		} else if ( cEle.id == "mininput" ) {
			var nv = ( value + 1 ) % 60;
			var sv = ( nv < 10 ) ? "0" + nv : "" + nv ;
			cEle.textContent = sv;			
		}
	}

	VatataKeyMove.fallUp = function ( cEle ) {
		var value = parseInt( cEle.textContent );
		if ( cEle.id == "hourinput" ) {
			var nv = ( value + 23 ) % 24;
			var sv = ( nv < 10 ) ? "0" + nv : "" + nv ;
			cEle.textContent = sv;
		} else if ( cEle.id == "mininput" ) {
			var nv = ( value + 59 ) % 60;
			var sv = ( nv < 10 ) ? "0" + nv : "" + nv ;
			cEle.textContent = sv;			
		}
	}

	document.onkeydown = function( e ) {
		var n = e.keyCode - 48;
		if ( n < 0 || n > 9 ) {
			return;
		}

		var cEle = VatataKeyMove.getCurrentEle();
		if( "hourinput" ==  cEle.id ) {
			var nstr = (cEle.textContent + n ).substring(1,3);
			var nv = parseInt(nstr);
			if ( nv < 0 || nv > 23 ) nv = n;
			var sv = ( nv < 10 ) ? "0" + nv : "" + nv ;
			cEle.textContent = sv;
		}
		else
		if( "mininput" ==  cEle.id ) {
			var nstr = (cEle.textContent + n ).substring(1,3);
			var nv = parseInt(nstr);
			if ( nv < 0 || nv > 59 ) nv = n;
			var sv = ( nv < 10 ) ? "0" + nv : "" + nv ;
			cEle.textContent = sv;
		}
	}

</script>

